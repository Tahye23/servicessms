<!-- Template HTML am√©lior√© pour le plan d'abonnement avec logique dynamique -->
<div class="flex justify-center py-8 min-h-screen">
  <div class="w-full max-w-6xl bg-white shadow-2xl rounded-2xl overflow-hidden">
    <!-- En-t√™te modernis√© -->
    <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-blue-700 p-8">
      <h2 class="text-3xl font-bold text-white flex items-center gap-4">
        <div class="p-2 bg-white/20 rounded-lg">
          <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"
            />
          </svg>
        </div>
        {{ planabonnement?.id ? 'Modifier' : 'Cr√©er' }} un Plan d'Abonnement
      </h2>
      <p class="text-blue-100 mt-3 text-lg">Configurez les d√©tails et les fonctionnalit√©s de votre plan avec des options dynamiques</p>
    </div>

    <form name="editForm" novalidate (ngSubmit)="save()" [formGroup]="editForm" class="p-8 space-y-8">
      <jhi-alert-error></jhi-alert-error>

      <!-- ID (readonly si √©dition) -->
      <div *ngIf="editForm.controls.id.value !== null" class="p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border">
        <label class="block text-sm font-semibold text-gray-700 mb-2">ID du Plan</label>
        <input
          type="number"
          id="field_id"
          formControlName="id"
          readonly
          class="block w-full rounded-lg border-gray-300 bg-gray-100 shadow-sm text-gray-600"
        />
      </div>

      <!-- Section: Informations de base -->
      <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <div class="p-2 bg-blue-500 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          Informations de base
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Nom du plan -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpName">
              Nom du plan <span class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="field_abpName"
              formControlName="abpName"
              required
              placeholder="Ex: Plan Premium, Plan Custom WhatsApp"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors"
            />
            <div
              *ngIf="editForm.get('abpName')?.invalid && editForm.get('abpName')?.touched"
              class="text-red-500 text-xs mt-1 flex items-center gap-1"
            >
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd"
                />
              </svg>
              Le nom du plan est obligatoire (2-255 caract√®res)
            </div>
          </div>

          <!-- Type de plan -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_planType">
              Type de plan <span class="text-red-500">*</span>
            </label>
            <select
              id="field_planType"
              formControlName="planType"
              required
              (change)="onPlanTypeChange($event)"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors"
            >
              <option value="">-- S√©lectionner le type --</option>
              <option value="FREE">üÜì Gratuit</option>
              <option value="SMS">üì± SMS</option>
              <option value="WHATSAPP">üí¨ WhatsApp</option>
              <option value="PREMIUM">‚≠ê Premium</option>
            </select>
            <div *ngIf="editForm.get('planType')?.invalid && editForm.get('planType')?.touched" class="text-red-500 text-xs mt-1">
              Veuillez s√©lectionner un type de plan
            </div>
          </div>
        </div>

        <!-- Description -->
        <div class="mt-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpDescription"> Description du plan </label>
          <textarea
            id="field_abpDescription"
            formControlName="abpDescription"
            rows="3"
            placeholder="D√©crivez les avantages et caract√©ristiques de ce plan..."
            class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none transition-colors"
          ></textarea>
          <div class="text-xs text-gray-500 mt-1">Maximum 1000 caract√®res</div>
        </div>
      </div>

      <!-- Section: Tarification (dynamique selon le type) -->
      <div *ngIf="shouldShowPricingSection()" class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <div class="p-2 bg-green-500 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"
              />
            </svg>
          </div>
          Tarification
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpPrice">
              Prix <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <input
                type="number"
                id="field_abpPrice"
                formControlName="abpPrice"
                min="0"
                step="0.01"
                required
                class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 transition-colors"
              />
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <span class="text-gray-500 text-sm">{{ editForm.get('abpCurrency')?.value || 'MRU' }}</span>
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpCurrency">Devise</label>
            <input
              type="text"
              id="field_abpCurrency"
              formControlName="abpCurrency"
              maxlength="3"
              placeholder="MRU"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 transition-colors"
            />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpPeriod">P√©riode</label>
            <select
              id="field_abpPeriod"
              formControlName="abpPeriod"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 transition-colors"
            >
              <option value="">-- S√©lectionner --</option>
              <option value="MONTHLY">üìÖ Mensuel</option>
              <option value="YEARLY">üóìÔ∏è Annuel</option>
              <option value="LIFETIME">‚ôæÔ∏è Aucune limite</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Section: Type de plan sp√©cialis√© -->
      <div *ngIf="isSpecializedPlan()" class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <div class="p-2 bg-purple-500 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a1 1 0 01-1-1V9a1 1 0 011-1h1a2 2 0 100-4H4a1 1 0 01-1-1V4a1 1 0 011-1h3a1 1 0 001-1v-1a2 2 0 114 0z"
              />
            </svg>
          </div>
          Configuration du Plan {{ getPlanTypeLabel() }}
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Option pour plan populaire -->
          <div class="flex items-center p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg border border-yellow-200">
            <input
              type="checkbox"
              id="field_abpPopular"
              formControlName="abpPopular"
              class="rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"
            />
            <label for="field_abpPopular" class="ml-3 text-sm font-semibold text-yellow-800 flex items-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path
                  d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                />
              </svg>
              Plan populaire (badge sp√©cial)
            </label>
          </div>

          <!-- Option pour plan personnalis√© -->
          <div class="flex items-center p-4 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg border border-blue-200">
            <input
              type="checkbox"
              id="field_customPlan"
              formControlName="customPlan"
              class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
            />
            <label for="field_customPlan" class="ml-3 text-sm font-semibold text-blue-800 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"
                />
              </svg>
              Plan personnalis√© / √Ä la demande
            </label>
          </div>
        </div>
      </div>

      <!-- Section: Limites et quotas (dynamique) -->
      <div class="bg-gradient-to-r from-indigo-50 to-blue-50 p-6 rounded-xl border border-indigo-200">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-gray-800 flex items-center gap-3">
            <div class="p-2 bg-indigo-500 rounded-lg">
              <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
            </div>
            Limites et Quotas
          </h3>

          <!-- Option pour limites illimit√©es -->
          <div *ngIf="canHaveUnlimited()" class="flex items-center">
            <input
              type="checkbox"
              id="field_unlimitedLimits"
              (change)="toggleUnlimitedLimits($event)"
              class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
            />
            <label for="field_unlimitedLimits" class="ml-2 text-sm font-semibold text-indigo-700"> ‚ôæÔ∏è Aucune limite </label>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <!-- Limite SMS (visible selon le type de plan) -->
          <div *ngIf="shouldShowSmsLimit()">
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_smsLimit">
              <span class="flex items-center gap-2"> üì± Limite SMS {{ getPlanTypeLabel() === 'SMS' ? '*' : '' }} </span>
            </label>
            <input
              type="number"
              id="field_smsLimit"
              formControlName="smsLimit"
              min="-1"
              placeholder="0 (0 = d√©sactiv√©, -1 = illimit√©)"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
            <div class="text-xs text-gray-500 mt-1">-1 pour illimit√©, 0 pour d√©sactiv√©</div>
          </div>

          <!-- Limite WhatsApp (visible selon le type de plan) -->
          <div *ngIf="shouldShowWhatsappLimit()">
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_whatsappLimit">
              <span class="flex items-center gap-2"> üí¨ Limite WhatsApp {{ getPlanTypeLabel() === 'WHATSAPP' ? '*' : '' }} </span>
            </label>
            <input
              type="number"
              id="field_whatsappLimit"
              formControlName="whatsappLimit"
              min="-1"
              placeholder="0 (0 = d√©sactiv√©, -1 = illimit√©)"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
            <div class="text-xs text-gray-500 mt-1">-1 pour illimit√©, 0 pour d√©sactiv√©</div>
          </div>

          <!-- Limite Utilisateurs -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_usersLimit">
              üë• Limite Utilisateurs <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              id="field_usersLimit"
              formControlName="usersLimit"
              min="-1"
              placeholder="1"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
            <div class="text-xs text-gray-500 mt-1">Minimum 1, -1 pour illimit√©</div>
          </div>

          <!-- Limite Templates -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_templatesLimit"> üìÑ Limite Templates </label>
            <input
              type="number"
              id="field_templatesLimit"
              formControlName="templatesLimit"
              min="-1"
              placeholder="0"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
          </div>

          <!-- Appels API par jour -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_maxApiCallsPerDay"> üîå Appels API/jour </label>
            <input
              type="number"
              id="field_maxApiCallsPerDay"
              formControlName="maxApiCallsPerDay"
              min="-1"
              placeholder="100"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
          </div>

          <!-- Stockage -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_storageLimitMb"> üíæ Stockage (MB) </label>
            <input
              type="number"
              id="field_storageLimitMb"
              formControlName="storageLimitMb"
              min="1"
              placeholder="100"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
          </div>

          <!-- Ordre d'affichage -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_sortOrder"> üî¢ Ordre d'affichage </label>
            <input
              type="number"
              id="field_sortOrder"
              formControlName="sortOrder"
              min="0"
              placeholder="0"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition-colors"
            />
          </div>
        </div>

        <!-- Alerte pour plan gratuit -->
        <div *ngIf="editForm.get('planType')?.value === 'FREE'" class="mt-4 p-4 bg-blue-100 border border-blue-300 rounded-lg">
          <div class="flex items-center gap-2 text-blue-800">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                clip-rule="evenodd"
              />
            </svg>
            <span class="font-semibold">Plan Gratuit :</span>
            <span>Les limites d√©finissent les quotas maximums gratuits</span>
          </div>
        </div>
      </div>

      <!-- Section: Permissions -->
      <div class="bg-gradient-to-r from-orange-50 to-red-50 p-6 rounded-xl border border-orange-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <div class="p-2 bg-orange-500 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              />
            </svg>
          </div>
          Permissions et Fonctionnalit√©s
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              type="checkbox"
              id="field_canManageUsers"
              formControlName="canManageUsers"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_canManageUsers" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"
                />
              </svg>
              Gestion des utilisateurs
            </label>
          </div>

          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              type="checkbox"
              id="field_canManageTemplates"
              formControlName="canManageTemplates"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_canManageTemplates" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              Gestion des templates
            </label>
          </div>

          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              type="checkbox"
              id="field_canViewConversations"
              formControlName="canViewConversations"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_canViewConversations" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                />
              </svg>
              Voir les conversations
            </label>
          </div>

          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              type="checkbox"
              id="field_canViewAnalytics"
              formControlName="canViewAnalytics"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_canViewAnalytics" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                />
              </svg>
              Voir les analytiques
            </label>
          </div>

          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              type="checkbox"
              id="field_prioritySupport"
              formControlName="prioritySupport"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_prioritySupport" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"
                />
              </svg>
              Support prioritaire
            </label>
          </div>
          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              id="canViewDashboard"
              type="checkbox"
              formControlName="canViewDashboard"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_prioritySupport" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              >
              <span class="mr-2">üìä</span>
              Acc√®s au dashboard
            </label>
          </div>

          <!-- Nouvelle permission: Gestion API -->
          <div class="flex items-center p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border transition-all hover:shadow-md">
            <input
              id="canManageAPI"
              type="checkbox"
              formControlName="canManageAPI"
              class="rounded border-gray-300 text-orange-600 focus:ring-orange-500"
            />
            <label for="field_prioritySupport" class="ml-3 text-sm font-semibold text-gray-700 flex items-center gap-2">
              <span class="mr-2">üîë</span>
              Gestion de l'API
            </label>
          </div>
        </div>
      </div>

      <!-- Section: Affichage et Pr√©sentation -->
      <div class="bg-gradient-to-r from-cyan-50 to-blue-50 p-6 rounded-xl border border-cyan-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <div class="p-2 bg-cyan-500 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2M7 4h10l2 2v11a2 2 0 01-2 2H5a2 2 0 01-2-2V6l2-2z"
              />
            </svg>
          </div>
          Affichage et Pr√©sentation
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpFeatures">
              Fonctionnalit√©s (s√©par√©es par virgule)
            </label>
            <textarea
              id="field_abpFeatures"
              formControlName="abpFeatures"
              rows="4"
              placeholder="Ex: 10,000 messages inclus, Support 24/7, API compl√®te, Tableaux de bord avanc√©s"
              class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 resize-none transition-colors"
            ></textarea>
            <div class="text-xs text-gray-500 mt-1 flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd"
                />
              </svg>
              S√©parez chaque fonctionnalit√© par une virgule
            </div>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_abpButtonText"> Texte du bouton d'action </label>
              <input
                type="text"
                id="field_abpButtonText"
                formControlName="abpButtonText"
                placeholder="Ex: Choisir ce plan, Nous contacter, Commencer"
                class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 transition-colors"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2" for="field_buttonClass"> Classe CSS du bouton </label>
              <select
                id="field_buttonClass"
                formControlName="buttonClass"
                class="block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 transition-colors"
              >
                <option value="">Style par d√©faut</option>
                <option value="btn-primary">üîµ Bouton Principal (Bleu)</option>
                <option value="btn-success">üü¢ Bouton Succ√®s (Vert)</option>
                <option value="btn-warning">üü° Bouton Attention (Jaune)</option>
                <option value="btn-danger">üî¥ Bouton Important (Rouge)</option>
                <option value="btn-gradient">üåà Bouton D√©grad√©</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Pr√©visualisation du plan -->
        <div *ngIf="editForm.get('abpName')?.value" class="mt-6 p-4 bg-white rounded-lg border border-gray-200 shadow-sm">
          <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
              />
            </svg>
            Aper√ßu du plan
          </h4>
          <div class="flex items-center justify-between">
            <div>
              <div class="flex items-center gap-2">
                <h5 class="font-bold text-lg">{{ editForm.get('abpName')?.value }}</h5>
                <span
                  *ngIf="editForm.get('abpPopular')?.value"
                  class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2 py-1 rounded-full"
                >
                  ‚≠ê POPULAIRE
                </span>
              </div>
              <p *ngIf="editForm.get('abpDescription')?.value" class="text-gray-600 text-sm mt-1">
                {{ editForm.get('abpDescription')?.value }}
              </p>
            </div>
            <div *ngIf="shouldShowPricingSection()" class="text-right">
              <div class="text-2xl font-bold text-gray-900">
                {{ editForm.get('abpPrice')?.value || 0 }} {{ editForm.get('abpCurrency')?.value || 'MRU' }}
              </div>
              <div *ngIf="editForm.get('abpPeriod')?.value" class="text-sm text-gray-500">/ {{ getPeriodLabel() }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section: √âtat -->
      <div class="bg-gradient-to-r from-emerald-50 to-green-50 p-6 rounded-xl border border-emerald-200">
        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
          <div class="p-2 bg-emerald-500 rounded-lg">
            <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          √âtat du Plan
        </h3>

        <div class="flex items-center p-4 bg-gradient-to-r from-green-100 to-emerald-100 rounded-lg border border-green-300">
          <input
            type="checkbox"
            id="field_active"
            formControlName="active"
            class="rounded border-gray-300 text-green-600 focus:ring-green-500"
          />
          <label for="field_active" class="ml-3 text-sm font-semibold text-green-800 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Plan actif et visible pour les utilisateurs
          </label>
        </div>

        <div *ngIf="!editForm.get('active')?.value" class="mt-3 p-3 bg-yellow-100 border border-yellow-300 rounded-lg">
          <div class="flex items-center gap-2 text-yellow-800 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                clip-rule="evenodd"
              />
            </svg>
            <span class="font-semibold">Attention :</span>
            <span>Ce plan ne sera pas visible par les utilisateurs tant qu'il n'est pas activ√©</span>
          </div>
        </div>
      </div>

      <!-- R√©sum√© des erreurs de validation -->
      <div *ngIf="getValidationErrors().length > 0" class="bg-red-50 border border-red-200 rounded-xl p-6">
        <h3 class="text-lg font-bold text-red-800 mb-4 flex items-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
              clip-rule="evenodd"
            />
          </svg>
          Erreurs de validation
        </h3>
        <ul class="space-y-2">
          <li *ngFor="let error of getValidationErrors()" class="text-red-700 text-sm flex items-start gap-2">
            <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                clip-rule="evenodd"
              />
            </svg>
            {{ error }}
          </li>
        </ul>
      </div>

      <!-- Actions -->
      <div class="flex justify-between items-center pt-8 border-t border-gray-200">
        <button
          type="button"
          (click)="previousState()"
          class="flex items-center bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-xl px-6 py-3 transition-all duration-200 hover:shadow-md"
        >
          <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Annuler
        </button>

        <div class="flex space-x-3">
          <button
            type="button"
            *ngIf="planabonnement?.id"
            (click)="previewPlan()"
            class="flex items-center bg-gradient-to-r from-yellow-500 to-orange-500 text-white hover:from-yellow-600 hover:to-orange-600 rounded-xl px-6 py-3 transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5"
          >
            <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
              />
            </svg>
            Pr√©visualiser
          </button>

          <button
            type="submit"
            [disabled]="editForm.invalid || isSaving || getValidationErrors().length > 0"
            class="flex items-center bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed rounded-xl px-8 py-3 transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5 disabled:transform-none"
          >
            <svg *ngIf="!isSaving" class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <svg *ngIf="isSaving" class="w-4 h-4 mr-2 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
              />
            </svg>
            <span *ngIf="!isSaving">{{ planabonnement?.id ? 'Mettre √† jour le plan' : 'Cr√©er le plan' }}</span>
            <span *ngIf="isSaving">Sauvegarde en cours...</span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
